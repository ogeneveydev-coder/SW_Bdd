<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Monster Search</title>

  <!--
    FICHIER : index.html
    VERSION : 1.2
    NOUVEAUTÉ v1.2 :
      - Trois zones de recherche indépendantes affichées côte à côte.
      - Chaque zone possède :
        * son champ texte
        * ses suggestions (max 5)
        * son bouton rechercher
        * son bloc de résultats
  -->

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">

  <style>
    /* Styles généraux */
    body { font-family: system-ui, sans-serif; margin: 2rem; color: #222; }
    h1 { margin: 0 0 0.25rem 0; }
    p.lead { margin: 0 0 1rem 0; color: #555; }
    .version { font-size: 0.9rem; color: #666; text-align: right; margin-bottom: 0.5rem; }

    /* Grille 3 colonnes pour les recherches distinctes */
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
    }

    /* Chaque bloc de recherche */
    .search-block { position: relative; }
    .search-block label { font-size: 0.85rem; color: #555; }
    .search-block input { width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #ccc; border-radius: 6px; }
    .search-block button { margin-top: 0.5rem; padding: 0.55rem 0.9rem; border-radius: 6px; border: 1px solid #2b6; background: #2b8; color: #fff; cursor: pointer; width: 100%; }

    /* Suggestions */
    .suggestions { border: 1px solid #ddd; background: #fff; position: absolute; top: 60px; left: 0; right: 0; z-index: 1000; box-shadow: 0 6px 18px rgba(0,0,0,0.06); border-radius: 6px; overflow: hidden; }
    .suggestions div { padding: 0.45rem 0.6rem; cursor: pointer; font-size: 0.95rem; color: #222; }
    .suggestions div:hover, .suggestions .active { background: #f4f7fb; }

    /* Résultats */
    .results { margin-top: 1rem; }
    .card {
      border: 1px solid #e2e8f0;
      padding: 0.9rem;
      border-radius: 10px;
      background: #fff;
      text-align: center;
      box-shadow: 0 2px 6px rgba(20,20,20,0.03);
    }
    .card img { border-radius: 8px; border: 1px solid #ddd; width: 80px; height: 80px; object-fit: contain; margin-bottom: 0.5rem; }
    .stat { margin: 0.18rem 0; font-size: 0.95rem; }
    .small { color: #666; font-size: 0.85rem; }
  </style>
</head>
<body>
  <div class="version" id="versionLabel">Version</div>
  <h1>Monster Search</h1>
  <p class="lead">Comparez jusqu’à 3 monstres en parallèle</p>

  <!-- NOUVEAUTÉ v1.2 : 3 blocs de recherche côte à côte -->
  <div class="grid">
    <div class="search-block" id="search1">
      <label for="monster1">Monstre 1</label>
      <input type="text" id="monster1" placeholder="Nom du monstre">
      <div class="suggestions"></div>
      <button>Rechercher</button>
      <div class="results"></div>
    </div>
    <div class="search-block" id="search2">
      <label for="monster2">Monstre 2</label>
      <input type="text" id="monster2" placeholder="Nom du monstre">
      <div class="suggestions"></div>
      <button>Rechercher</button>
      <div class="results"></div>
    </div>
    <div class="search-block" id="search3">
      <label for="monster3">Monstre 3</label>
      <input type="text" id="monster3" placeholder="Nom du monstre">
      <div class="suggestions"></div>
      <button>Rechercher</button>
      <div class="results"></div>
    </div>
  </div>

  <script>
    const APP_VERSION = "1.2";
    let monsters = [];
    const SUGGESTION_LIMIT = 5;
    document.getElementById("versionLabel").textContent = `Version ${APP_VERSION}`;

    async function loadMonsters() {
      try {
        const res = await fetch("monsters_sw.json");
        monsters = await res.json();
        console.log(`✅ Monster Search v${APP_VERSION} chargé avec ${monsters.length} monstres.`);
      } catch (err) {
        console.error("Erreur JSON :", err);
      }
    }

    /* Fonction pour initialiser un bloc de recherche */
    function initSearchBlock(block) {
      const input = block.querySelector("input");
      const btn = block.querySelector("button");
      const suggestions = block.querySelector(".suggestions");
      const results = block.querySelector(".results");
      let activeIndex = -1;

      function clearSuggestions() {
        suggestions.innerHTML = "";
        activeIndex = -1;
      }

      function updateSuggestions() {
        const q = input.value.trim().toLowerCase();
        clearSuggestions();
        if (!q) return;

        const matches = monsters.filter(m => m.name && m.name.toLowerCase().includes(q)).slice(0, SUGGESTION_LIMIT);
        matches.forEach((m, idx) => {
          const div = document.createElement("div");
          div.textContent = m.name;
          div.addEventListener("click", () => {
            input.value = m.name;
            clearSuggestions();
            search();
          });
          suggestions.appendChild(div);
        });
      }

      function search() {
        const q = input.value.trim().toLowerCase();
        results.innerHTML = "";
        if (!q) return;
        const found = monsters.filter(m => m.name && m.name.toLowerCase().includes(q));
        if (found.length === 0) {
          results.innerHTML = `<p>Aucun monstre trouvé</p>`;
          return;
        }
        const monster = found[0];
        const card = document.createElement("div");
        card.className = "card";
        const imgUrl = monster.image_filename ? `https://swarfarm.com/static/herders/images/monsters/${monster.image_filename}` : "";
        card.innerHTML = `
          <img src="${imgUrl}" alt="${monster.name}">
          <h3>${monster.name}</h3>
          <p class="stat"><strong>Élément :</strong> ${monster.element || "–"}</p>
          <p class="stat"><strong>Archétype :</strong> ${monster.archetype || "–"}</p>
          <p class="stat"><strong>Étoiles :</strong> ${monster.base_stars || "–"}</p>
          <p class="stat"><strong>HP :</strong> ${monster.max_lvl_hp || "–"}</p>
          <p class="stat"><strong>ATK :</strong> ${monster.max_lvl_attack || "–"}</p>
          <p class="stat"><strong>DEF :</strong> ${monster.max_lvl_defense || "–"}</p>
          <p class="stat"><strong>Vitesse :</strong> ${monster.speed || "–"}</p>
        `;
        results.appendChild(card);
      }

      input.addEventListener("input", updateSuggestions);
      btn.addEventListener("click", search);
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") { e.preventDefault(); clearSuggestions(); search(); }
      });
      document.addEventListener("click", (ev) => {
        if (!block.contains(ev.target)) clearSuggestions();
      });
    }

    // Initialiser les 3 zones
    ["search1", "search2", "search3"].forEach(id => initSearchBlock(document.getElementById(id)));

    loadMonsters();
  </script>
</body>
</html>
